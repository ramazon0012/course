{% extends "base.html" %} {% block title %}Cart{% endblock title %} 
{% block content %} 
<section class="pt-5 pb-9">
  <div class="container-small cart">
    <h2 class="mb-6">Cart</h2>
    <div class="row g-5">
      <div class="col-12 col-lg-8">
        <div
          id="cartTable"
          data-list='{"valueNames":["products","color","size","price","quantity","total"],"page":10}'
        >
          <div class="table-responsive scrollbar mx-n1 px-1">
            <table class="table fs-9 mb-0 border-top border-translucent">
              <thead>
                <tr>
                  <th
                    class="sort white-space-nowrap align-middle fs-10"
                    scope="col"
                  ></th>
                  <th
                    class="sort white-space-nowrap align-middle"
                    scope="col"
                    style="min-width: 250px"
                  >
                    PRODUCTS
                  </th>
                  <th
                    class="sort align-middle text-end"
                    scope="col"
                    style="width: 300px"
                  >
                    PRICE
                  </th>
                  <th
                    class="sort align-middle ps-5"
                    scope="col"
                    style="width: 200px"
                  >
                    QUANTITY
                  </th>
                  <th
                    class="sort align-middle text-end"
                    scope="col"
                    style="width: 250px"
                  >
                    REMOVE
                  </th>
                  <th class="sort text-end align-middle pe-0" scope="col">
                    TOTAL
                  </th>
                </tr>
              </thead>
              <tbody class="list" id="cart-table-body">
                {% for item in cart %} {% with product=item.course %}
                <tr class="cart-table-row btn-reveal-trigger">
                  <td class="align-middle white-space-nowrap py-0">
                  </td>
                  <td class="products align-middle">
                    <a
                      class="fw-semibold mb-0 line-clamp-2"
                      href="{{ product.get_absolute_url }}"
                      >{{ product.name }}</a
                    >
                  </td>
                  <td
                    class="price align-middle text-body fs-9 fw-semibold text-end"
                  >
                    ${{ item.price }}
                  </td>
                  <td class="quantity align-middle fs-8 ps-5">
                      <div class="input-group input-group-sm flex-nowrap" data-quantity="data-quantity">
                          <button class="btn btn-sm px-2" data-type="minus">-</button>
                          <input
                              class="form-control text-center input-spin-none bg-transparent border-0 px-0"
                              type="number"
                              min="1"
                              value="{{ item.quantity }}"
                              aria-label="Amount (to the nearest dollar)"
                          />
                          <button class="btn btn-sm px-2" data-type="plus">+</button>
                      </div>
                  </td>
                  <td class="align-middle white-space-nowrap text-end pe-0 ps-3">
                    {% comment %} <form action="{% url "cart:cart_remove" product.id %}" method="post">
                        <button type="submit" class="btn btn-outline-light">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                            <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
                          </svg>
                        </button>
                        {% csrf_token %}
                    </form> {% endcomment %}
                  </td>
                  <td class="total align-middle fw-bold text-body-highlight text-end">
                    ${{ item.total_price }}
                  </td>
                </tr>
                {% endwith %} 
                {% endfor %}
                <tr class="cart-table-row btn-reveal-trigger">
                  <td
                    class="text-body-emphasis fw-semibold ps-0 fs-8"
                    colspan="6"
                  >
                    Items subtotal :
                  </td>
                  <td class="text-body-emphasis fw-bold text-end fs-8">${{ cart.get_total_price }}</td>
                  <td>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-between-center mb-3">
              <h3 class="card-title mb-0">Summary</h3>
              <a class="btn btn-link p-0" href="#!">Edit cart </a>
            </div>
            <div>
              <div class="d-flex justify-content-between">
                <p class="text-body fw-semibold">Items subtotal :</p>
                <p class="text-body-emphasis fw-semibold">${{ cart.get_total_price }}</p>
              </div>
            </div>
            <div class="input-group mb-3">
              <input class="form-control" type="text" placeholder="Voucher" />
              <button class="btn btn-phoenix-primary px-5">Apply</button>
            </div>
            <div
              class="d-flex justify-content-between border-y border-dashed py-3 mb-4"
            >
              <h4 class="mb-0">Total :</h4>
              <h4 class="mb-">${{ cart.get_total_price }}</h4>
            </div>
            <a href="{% url "orders:order_create" %}">
              <button class="btn btn-primary w-100">
                Proceed to check out<span
                  class="fas fa-chevron-right ms-1 fs-10"
                ></span>
              </button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end of .container-->
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('[data-type="minus"]').forEach(function (button) {
          button.addEventListener('click', function () {
              updateQuantity(this, -1);
          });
      });

      document.querySelectorAll('[data-type="plus"]').forEach(function (button) {
          button.addEventListener('click', function () {
              updateQuantity(this, 1);
          });
      });
  });

  function updateQuantity(button, change) {
      var input = button.parentNode.querySelector('input');
      var productId = input.getAttribute('data-product-id');
      var currentValue = parseInt(input.value);
      var newValue = currentValue + change;

      // Ensure the new value is at least 1
      newValue = Math.max(newValue, 1);

      // Update the input value
      input.value = newValue;

      // You may also want to send an AJAX request to update the server-side quantity
      // For now, let's just log the updated quantity to the console
      console.log('Product ID:', productId, 'New Quantity:', newValue);
  }
</script>

{% endblock %}
